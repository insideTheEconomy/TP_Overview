function WAMP(e){var t,n=require("autobahn");self=this;self.clientType=e;self.callbacks=e.wampMethods;self.currentOffers=[];self.myPlayer;self.offer;var r,i=new n.Connection({url:"ws://tpserver.local:8080/ws",realm:"tradingpit"});i.onopen=function(e){self.sess=e;var t=null;self.sess.subscribe("pit.pub."+self.sess.id,self.callbacks.onCard);e.subscribe("pit.pub.offers",self.callbacks.onOffer).then(function(e){t=e;console.log("subbed to offers",e)},function(e){});e.subscribe("pit.pub.clock",self.callbacks.onTick).then(function(e){t=e},function(e){})};i.open()}var aiwamp=function(){this.wampMethods={test:function(){alert("I'm an AI!")},onCard:function(e,t,n){},onTick:function(e,t,n){},onOffer:function(e,t,n){},onAccept:function(e,t,n){}};this.wamp=new WAMP(this)},playerwamp=function(){this.wampMethods={test:function(){alert("I'm a Player!")},onCard:function(e,t,n){console.log("CARD",t);$(".moneyCounter").html("$"+t.surplus);$(".value").html(t.reserve);reserve=t.reserve;self.myPlayer=t},onTick:function(e,t,n){$("#time").html(t.minutes+":"+t.seconds)},onOffer:function(e,t,n){$.get("offer_template.html",function(e){Mustache.parse(e);var n=Mustache.render(e,t);$("#offers").html(n)})},submitOffer:function(e){self.offer.owner=self.myPlayer;self.offer.price=e;console.log("self.offer= ",self.offer);w.wampMethods.rpcCall("offer")},accept:function(e){self.acceptedOffer=self.currentOffers[e%4];w.wampMethods.rpcCall("accept")},rpcCall:function(e){console.log(e);if(e=="signin")self.sess.call("pit.rpc.signin",[],{id:self.sess.id,player:{role:"buyer",position:0,id:self.sess.id,meat:"true",name:"QT"}}).then(function(e){myShape=e.shape;$(".my-logoDiv").load("shapes.html  #"+myShape);self.sess.call("pit.rpc.offerTemplate").then(function(e){self.offer=e})});else if(e=="offer")self.sess.call("pit.rpc.offer",[],{id:self.sess.id,offer:self.offer});else if(e=="accept"){console.log("RPC CALL self.acceptedOffer= ",self.acceptedOffer);self.sess.call("pit.rpc.accept",[],{id:self.sess.id,offer:self.acceptedOffer}).then(function(e){console.log("onAccept return r: ",e)},function(e){console.log("Error: ",e)})}}};this.wamp=new WAMP(this)};ai?w=new aiwamp:w=new playerwamp;